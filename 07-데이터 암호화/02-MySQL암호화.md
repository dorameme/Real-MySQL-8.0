# MySQL 의 암호화
---

## 1. 전송 중 암호화 (In-Transit Encryption)

 개념: 클라이언트 ↔ 서버 간 데이터 전송을 암호화
 방법: SSL/TLS를 이용
 특징

   네트워크에서 도청 방지
   MySQL 설정에서 `--require_secure_transport=ON` 옵션으로 강제 가능
 실무 사용

   보안 요구되는 환경(금융, 공공기관 등)에서 거의 필수
   클라우드 DB 서비스(AWS RDS, GCP Cloud SQL 등)는 기본적으로 TLS 지원

---

## 2. 데이터베이스 내부 암호화 (At-Rest Encryption)

 개념: 디스크에 저장된 데이터(테이블, 로그, 백업 등)를 암호화
 방법: TDE (Transparent Data Encryption)

   MySQL 5.7 이상(InnoDB)에서 제공
   InnoDB 테이블스페이스와 로그 파일을 자동 암호화
 특징

   데이터 파일이 탈취되어도 키 없이는 복호화 불가
   키 관리: MySQL 자체 키링(Keyring Plugin) or 외부 KMS(AWS KMS, HashiCorp Vault 등)
 실무 사용

   금융, 의료, 개인정보 처리 시스템에서 주로 사용
   규제 준수를 위해 AES-256 같은 강력한 알고리즘 적용

---

## 3. 컬럼/응용 레벨 암호화 (Application / Column-Level Encryption)

 개념: 특정 컬럼 값(예: 주민번호, 카드번호)을 직접 암호화
 방법:

   MySQL 내장 함수 사용:

     `AES_ENCRYPT()`, `AES_DECRYPT()`
   또는 애플리케이션 레벨에서 암호화 후 저장
 특징

   세밀한 보안 적용 가능
   검색·인덱싱 불편 (암호화된 값은 일반 인덱스로 사용하기 어려움)
 실무 사용

   개인정보 보호법, GDPR 등 규제 준수를 위해 주민번호, 계좌번호, 카드번호 저장 시 활용

---

## 4. 요약

| 구분       | 개념                          | 특징          | 실무 활용                |
| -------- | --------------------------- | ----------- | -------------------- |
| 전송 중 암호화 | 클라이언트 ↔ 서버 통신 암호화 (TLS/SSL) | 네트워크 도청 방지  | 클라우드 서비스 기본 적용       |
| 저장소 암호화  | 테이블/로그/백업 파일 암호화 (TDE)      | 투명, 키 관리 필요 | 금융/의료 데이터 저장 시 필수    |
| 컬럼 암호화   | 특정 컬럼 값 직접 암호화              | 인덱스 사용 어려움  | 주민번호, 카드번호 등 민감정보 보호 |

---

즉, MySQL 암호화는 TLS(전송), TDE(저장소), AES 컬럼 암호화 세 가지 레벨로 나뉘며, 규제와 시스템 성격에 맞춰 조합해서 사용한다.


# MySQL 데이터 암호화 방식

MySQL에서 데이터 보호를 위한 암호화 방식은 응용프로그램 단 암호화와 데이터베이스 단 암호화로 구분된다.     
두 방식은 상호 보완적이며 보안 요구사항에 따라 단독 또는 함께 사용된다.

## 1. 응용프로그램 단 암호화 (Application-Level Encryption)

### 개념
데이터 암호화와 복호화 과정을 애플리케이션 코드 내에서 처리하는 방식이다. 주로 개인정보와 같은 특정 컬럼을 대상으로 적용된다.

### 주요 특징
- 보안 강도 높음: 데이터베이스가 유출되어도 암호화된 컬럼은 평문으로 노출되지 않음
- 인덱스 제약 존재: 암호화된 데이터는 범위 검색(BETWEEN, ORDER BY, LIKE)이 비효율적이거나 불가능
- 개발 복잡도 증가: 암호화 로직을 애플리케이션에 구현하고 키를 안전하게 관리해야 함

### 실무 적용
- 주민등록번호, 신용카드 번호, 비밀번호 등 소수 민감 정보 보호에 사용
- 높은 보안 요구 시스템에서는 DB 단 암호화와 병행하여 이중 암호화 적용

## 2. 데이터베이스 단 암호화 (Database-Level Encryption)

### 개념
MySQL 엔진 자체에서 디스크에 저장되는 데이터 파일을 암호화하는 방식이다. TDE(Transparent Data Encryption)가 대표적이며 테이블스페이스 단위로 적용된다.

### TDE (Transparent Data Encryption)
- 투명성 제공: 애플리케이션은 암호화 여부를 인지하지 못함
- 암호화 지점: 디스크 읽기/쓰기 시점에서만 암호화 수행
- 성능 영향: 디스크 I/O 시 오버헤드 발생하나 메모리 캐시 시 영향 미미

### 키 관리 (Keyring)
2-Tier 키 관리 구조를 사용한다:

1. 테이블스페이스 키 (Tablespace Key)
   - 실제 데이터 암호화에 사용
   - 테이블스페이스마다 고유 키 생성
   - 마스터 키로 암호화되어 데이터 파일 헤더에 저장

2. 마스터 키 (Master Key)
   - 테이블스페이스 키를 암호화하는 최상위 키
   - keyring_file, keyring_okv, keyring_aws 등 플러그인 통해 외부 저장
   - 정기적인 키 Rotation 필요

### 알고리즘
- AES-256 알고리즘만 지원

## 3. 방식 비교

| 구분 | 응용프로그램 단 암호화 | 데이터베이스 단 암호화 (TDE) |
|------|------------------------|-----------------------------|
| 암호화 단위 | 컬럼 단위 | 테이블/테이블스페이스 단위 |
| 보안 강점 | DB 유출 시 데이터 보호 | 디스크/백업본 유출 시 데이터 보호 |
| 성능 제약 | 인덱스 활용도 낮음, 범위 검색 불가 | 디스크 I/O 오버헤드 |
| 운용 복잡도 | 개발 구현 및 키 관리 필요 | DB 설정만으로 완료, 키 관리 자동화 가능 |
| 주요 사용처 | 소수 민감 컬럼 보호 | 전체 데이터 보호, 규정 준수 |

## 4. 결론 및 선택 가이드

- 소수 민감 컬럼 보호가 목적이면 → 응용프로그램 단 암호화
- 전체 데이터 보호와 규정 준수가 목적이면 → 데이터베이스 단 암호화 (TDE)
- 최상위 보안이 요구되면 → 두 방식을 함께 적용한 이중 암호화 전략 사용

## 5. TDE 설정 예시 (keyring_file 기반)

```sql
-- keyring_file 플러그인 설치
INSTALL PLUGIN keyring_file SONAME 'keyring_file.so';

-- keyring 파일 위치 설정 (my.cnf에도 동일하게 설정)
SET GLOBAL keyring_file_data = '/var/lib/mysql-keyring/keyring';

-- 암호화할 테이블 생성
CREATE TABLE sensitive_data (
    id INT PRIMARY KEY,
    secret_data VARCHAR(255)
) ENCRYPTION='Y';

-- 기존 테이블 암호화 적용
ALTER TABLE existing_table ENCRYPTION='Y';
```

keyring_file 데이터는 반드시 안전한 위치에 저장하고 접근 권한을 제한하는 것이 중요하다.


