# MySQL 데이터 암호화 방식

MySQL에서 데이터 보호를 위한 암호화 방식은 응용프로그램 단 암호화와 데이터베이스 단 암호화로 구분된다. 두 방식은 상호 보완적이며 보안 요구사항에 따라 단독 또는 함께 사용된다.

## 1. 응용프로그램 단 암호화 (Application-Level Encryption)

### 개념
데이터 암호화와 복호화 과정을 애플리케이션 코드 내에서 처리하는 방식이다. 주로 개인정보와 같은 특정 컬럼을 대상으로 적용된다.

### 주요 특징
- 보안 강도 높음: 데이터베이스가 유출되어도 암호화된 컬럼은 평문으로 노출되지 않음
- 인덱스 제약 존재: 암호화된 데이터는 범위 검색(BETWEEN, ORDER BY, LIKE)이 비효율적이거나 불가능
- 개발 복잡도 증가: 암호화 로직을 애플리케이션에 구현하고 키를 안전하게 관리해야 함

### 실무 적용
- 주민등록번호, 신용카드 번호, 비밀번호 등 소수 민감 정보 보호에 사용
- 높은 보안 요구 시스템에서는 DB 단 암호화와 병행하여 이중 암호화 적용

## 2. 데이터베이스 단 암호화 (Database-Level Encryption)

### 개념
MySQL 엔진 자체에서 디스크에 저장되는 데이터 파일을 암호화하는 방식이다. TDE(Transparent Data Encryption)가 대표적이며 테이블스페이스 단위로 적용된다.

### TDE (Transparent Data Encryption)
- 투명성 제공: 애플리케이션은 암호화 여부를 인지하지 못함
- 암호화 지점: 디스크 읽기/쓰기 시점에서만 암호화 수행
- 성능 영향: 디스크 I/O 시 오버헤드 발생하나 메모리 캐시 시 영향 미미

### 키 관리 (Keyring)
2-Tier 키 관리 구조를 사용한다:

1. 테이블스페이스 키 (Tablespace Key)
   - 실제 데이터 암호화에 사용
   - 테이블스페이스마다 고유 키 생성
   - 마스터 키로 암호화되어 데이터 파일 헤더에 저장

2. 마스터 키 (Master Key)
   - 테이블스페이스 키를 암호화하는 최상위 키
   - keyring_file, keyring_okv, keyring_aws 등 플러그인 통해 외부 저장
   - 정기적인 키 Rotation 필요

### 알고리즘
- AES-256 알고리즘만 지원

## 3. 방식 비교

| 구분 | 응용프로그램 단 암호화 | 데이터베이스 단 암호화 (TDE) |
|------|------------------------|-----------------------------|
| 암호화 단위 | 컬럼 단위 | 테이블/테이블스페이스 단위 |
| 보안 강점 | DB 유출 시 데이터 보호 | 디스크/백업본 유출 시 데이터 보호 |
| 성능 제약 | 인덱스 활용도 낮음, 범위 검색 불가 | 디스크 I/O 오버헤드 |
| 운용 복잡도 | 개발 구현 및 키 관리 필요 | DB 설정만으로 완료, 키 관리 자동화 가능 |
| 주요 사용처 | 소수 민감 컬럼 보호 | 전체 데이터 보호, 규정 준수 |

## 4. 결론 및 선택 가이드

- 소수 민감 컬럼 보호가 목적이면 → 응용프로그램 단 암호화
- 전체 데이터 보호와 규정 준수가 목적이면 → 데이터베이스 단 암호화 (TDE)
- 최상위 보안이 요구되면 → 두 방식을 함께 적용한 이중 암호화 전략 사용

## 5. TDE 설정 예시 (keyring_file 기반)

```sql
-- keyring_file 플러그인 설치
INSTALL PLUGIN keyring_file SONAME 'keyring_file.so';

-- keyring 파일 위치 설정 (my.cnf에도 동일하게 설정)
SET GLOBAL keyring_file_data = '/var/lib/mysql-keyring/keyring';

-- 암호화할 테이블 생성
CREATE TABLE sensitive_data (
    id INT PRIMARY KEY,
    secret_data VARCHAR(255)
) ENCRYPTION='Y';

-- 기존 테이블 암호화 적용
ALTER TABLE existing_table ENCRYPTION='Y';
```

keyring_file 데이터는 반드시 안전한 위치에 저장하고 접근 권한을 제한하는 것이 중요하다.
